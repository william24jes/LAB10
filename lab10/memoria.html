<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Juego de Memoria</title>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
              crossorigin="anonymous">
        <style>
            .card {
                width: 200px;
                height: 200px;
                background-color: blue;
                margin: 5px;
                display: inline-block;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                position: relative;
                overflow: hidden;
            }

            #tablero {
                margin: auto;
            }
        </style>
    </head>
    <body>
        <div class="container mt-4">
            <h1>El Juego de la Memoria</h1>
            <br>
            <h6>Total de imágenes seleccionadas: <span id="numero">0</span></h6>
            <div class="custom-file mb-3">
                <input type="file" class="custom-file-input" id="imagenInput" accept=".png" multiple>
                <label class="custom-file-label" for="imagenInput">Seleccionar imágenes...</label>
            </div>
            <button id="subir" class="btn btn-primary">Subir imágenes</button>
            <button id="crear" class="btn btn-success" disabled>Crear tablero</button>
        </div>

        <div class="container mt-4">
            <div id="imagenesGuardadas" class="row"></div>
        </div>

        <div class="container mt-4">
            <button id="empezarJuego" class="btn btn-primary" style="display: none;">Empezar juego</button>
            <div id="tablero"></div>
        </div>

        <script>
            $(document).ready(function () {
                var imagesArray = [];
                var max = 15;
                var cantidad = 0;
                var seleccionadas = [];
                var bloquearClick = false;

                $('#subir').click(function () {
                    var files = $('#imagenInput').get(0).files;
                    if (files.length > 0 && files.length <= max) {
                        if (cantidad + files.length > max) {
                            alert('El número máximo de imágenes permitidas es ' + max);
                            return;
                        }
                        for (var i = 0; i < files.length; i++) {
                            var file = files[i];
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var imageSrc = e.target.result;
                                if (!imagesArray.includes(imageSrc)) {
                                    imagesArray.push(imageSrc);
                                    imagesArray.push(imageSrc); // Agregar una duplicada
                                    $('#imagenesGuardadas').append('<div class="col-4"><button style="height: 30px;width: 30px" class="borrar" data-id="' + (cantidad + i) + '">X</button><img class="img-fluid" src="' + imageSrc + '" ></div>');
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                        cantidad += files.length;
                        $('#numero').text(cantidad);

                        if (cantidad >= 2 && cantidad <= max) {
                            $("#crear").attr("disabled", false);
                        }
                    } else {
                        alert('El número de imágenes debe ser entre 1 y ' + max);
                    }
                });

                $(document).on('click', '.borrar', function () {
                    var id = $(this).data('id');
                    imagesArray.splice(id, 2); // Eliminar tanto la imagen como su duplicado
                    $(this).parent().remove();
                    cantidad--;
                    $('#numero').text(cantidad);

                    if (cantidad < 2 || cantidad > max) {
                        $("#crear").attr("disabled", true);
                    }
                });

                $('#crear').click(function () {
                    createBoard();
                    $(this).attr("disabled", true);
                    $("#empezarJuego").show();
                });

                $('#empezarJuego').click(function () {
                    shuffleImages();
                    hideImages();
                });

                $(document).on('click', '.card', function () {
                    if (bloquearClick) {
                        return;
                    }

                    var index = $(this).data('index');
                    var image = imagesArray[index];

                    if ($(this).hasClass('visible')) {
                        return;
                    }

                    $(this).css('background-image', 'url("' + image + '")');
                    $(this).css('background-size', '100% 100%');
                    $(this).addClass('visible');
                    seleccionadas.push({
                        element: $(this),
                        image: image
                    });

                    if (seleccionadas.length === 2) {
                        bloquearClick = true;
                        setTimeout(function () {
                            if (seleccionadas[0].image === seleccionadas[1].image) {
                                seleccionadas[0].element.addClass('encontrada');
                                seleccionadas[1].element.addClass('encontrada');
                            } else {
                                seleccionadas[0].element.css('background-image', '');
                                seleccionadas[1].element.css('background-image', '');
                                seleccionadas[0].element.removeClass('visible');
                                seleccionadas[1].element.removeClass('visible');
                            }
                            seleccionadas = [];
                            bloquearClick = false;
                        }, 1000);
                    }
                });

                function createBoard() {
                    var totalImages = imagesArray.length;
                    var rows = 0;
                    var columns = 0;

                    // Calcular el número de filas y columnas
                    if (Math.sqrt(totalImages) % 1 === 0) {
                        rows = Math.sqrt(totalImages);
                        columns = rows;
                    } else {
                        columns = Math.floor(Math.sqrt(totalImages));
                        rows = Math.ceil(totalImages / columns);
                    }

                    // Asegurar que siempre haya más filas que columnas
                    if (columns > rows) {
                        [rows, columns] = [columns, rows];
                    }

                    // Crear las tarjetas del juego
                    var tablero = $('#tablero');
                    tablero.empty(); // Limpiar el tablero antes de rellenarlo
                    for (var r = 0; r < rows; r++) {
                        var fila = $('<div class="row"></div>');
                        for (var c = 0; c < columns; c++) {
                            var columna = $('<div class="col-2 card"></div>'); // Reduce el tamaño del tablero cambiando 'col' a 'col-2'
                            fila.append(columna);
                        }
                        tablero.append(fila);
                    }
                }


                function hideImages() {
                    var cards = $('.card');
                    cards.css('background-image', '');
                    cards.removeClass('visible');
                    cards.removeClass('encontrada');
                }



                function shuffleImages() {
                    var cards = $('.card');
                    var copyImagesArray = [...imagesArray];
                    cards.each(function () {
                        if (copyImagesArray.length > 0) {
                            var randomPosition = Math.floor(Math.random() * copyImagesArray.length);
                            $(this).data('index', randomPosition); // Asignar el índice aleatorio a cada tarjeta
                            copyImagesArray.splice(randomPosition, 1);
                        }
                    });
                }
            });
        </script>


    </body>
</html>
